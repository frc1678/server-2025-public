# Copyright (c) 2023 FRC Team 1678: Citrus Circuits

from unittest import mock

from calculations import base_calculations
from calculations import auto_paths
from server import Server
import pytest


class TestAutoPathCalc:

    obj_teams = [{"team_number": "254"}, {"team_number": "4414"}, {"team_number": "1678"}]

    expected_obj_teams = [
        {"team_number": "254"},
        {"team_number": "4414"},
        {"team_number": "1678"},
    ]

    auto_pims = [
        {
            # 254, 1
            "match_number": 42,
            "team_number": "254",
            "start_position": "1",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_1",
            "score_2": "reef_F3_L4",
            "intake_position_2": "station_1",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_reef_F4"},
                {"in_teleop": False, "time": 146, "action_type": "auto_score_F3_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 148, "action_type": "auto_score_F3_L4"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 150, "action_type": "auto_score_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 0,
            "num_matches_ran": 0,
            "is_sus": False,
        },
        {
            # 1678, 1
            "match_number": 43,
            "team_number": "1678",
            "start_position": "2",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_2",
            "score_2": "reef_F5_L4",
            "intake_position_2": "station_2",
            "score_3": "reef_F6_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "station_2",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 146, "action_type": "auto_score_F6_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 148, "action_type": "auto_score_F5_L4"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 150, "action_type": "auto_score_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 0,
            "num_matches_ran": 0,
            "is_sus": False,
        },
        {
            # 4414, 1
            "match_number": 44,
            "team_number": "4414",
            "start_position": "3",
            "has_preload": True,
            "score_1": "net",
            "intake_position_1": "mark_1_coral",
            "score_2": "net",
            "intake_position_2": "mark_2_algae",
            "score_3": "processor",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "mark_3_coral",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_mark_3_coral"},
                {"in_teleop": False, "time": 146, "action_type": "processor"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_mark_2_algae"},
                {"in_teleop": False, "time": 148, "action_type": "net"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_mark_1_coral"},
                {"in_teleop": False, "time": 150, "action_type": "net"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 0,
            "num_matches_ran": 0,
            "is_sus": False,
        },
        {
            # 254, 2
            "match_number": 45,
            "team_number": "254",
            "start_position": "1",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_1",
            "score_2": "fail_reef_F5_L2",
            "intake_position_2": "station_1",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_reef_F4"},
                {"in_teleop": False, "time": 146, "action_type": "auto_reef_F3_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 148, "action_type": "auto_fail_reef_F5_L2"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 150, "action_type": "auto_reef_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 0,
            "num_matches_ran": 0,
            "is_sus": False,
        },
        {
            # 1678, 2
            "match_number": 46,
            "team_number": "1678",
            "start_position": "2",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_2",
            "score_2": "fail_reef_F5_L4",
            "intake_position_2": "station_2",
            "score_3": "reef_F6_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "station_2",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 146, "action_type": "auto_score_F6_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 148, "action_type": "auto_fail_score_F5_L4"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 150, "action_type": "auto_score_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 0,
            "num_matches_ran": 0,
            "is_sus": False,
        },
    ]

    expected_auto_pims = [
        {
            # 254, 1
            "match_number": 42,
            "team_number": "254",
            "start_position": "1",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_1",
            "score_2": "reef_F3_L4",
            "intake_position_2": "station_1",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_reef_F4"},
                {"in_teleop": False, "time": 146, "action_type": "auto_score_F3_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 148, "action_type": "auto_score_F3_L4"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 150, "action_type": "auto_score_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 1,
            "num_matches_ran": 1,
            "is_sus": False,
        },
        {
            # 1678, 1
            "match_number": 43,
            "team_number": "1678",
            "start_position": "2",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_2",
            "score_2": "reef_F5_L4",
            "intake_position_2": "station_2",
            "score_3": "reef_F6_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "station_2",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 146, "action_type": "auto_score_F6_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 148, "action_type": "auto_score_F5_L4"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 150, "action_type": "auto_score_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 1,
            "num_matches_ran": 2,
            "is_sus": False,
        },
        {
            # 4414, 1
            "match_number": 44,
            "team_number": "4414",
            "start_position": "3",
            "has_preload": True,
            "score_1": "net",
            "intake_position_1": "mark_1_coral",
            "score_2": "net",
            "intake_position_2": "mark_2_algae",
            "score_3": "processor",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "mark_3_coral",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_mark_3_coral"},
                {"in_teleop": False, "time": 146, "action_type": "processor"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_mark_2_algae"},
                {"in_teleop": False, "time": 148, "action_type": "net"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_mark_1_coral"},
                {"in_teleop": False, "time": 150, "action_type": "net"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 1,
            "num_matches_ran": 1,
            "is_sus": False,
        },
        {
            # 254, 2
            "match_number": 45,
            "team_number": "254",
            "start_position": "1",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_1",
            "score_2": "fail_reef_F5_L2",
            "intake_position_2": "station_1",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_reef_F4"},
                {"in_teleop": False, "time": 146, "action_type": "auto_reef_F3_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 148, "action_type": "auto_fail_reef_F5_L2"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_1"},
                {"in_teleop": False, "time": 150, "action_type": "auto_reef_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 2,
            "num_matches_ran": 1,
            "is_sus": False,
        },
        {
            # 1678, 2
            "match_number": 46,
            "team_number": "1678",
            "start_position": "2",
            "has_preload": True,
            "score_1": "reef_F1_L4",
            "intake_position_1": "station_2",
            "score_2": "fail_reef_F5_L4",
            "intake_position_2": "station_2",
            "score_3": "reef_F6_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "intake_position_3": "station_2",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "leave": True,
            "auto_timeline": [
                {"in_teleop": False, "time": 145, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 146, "action_type": "auto_score_F6_L4"},
                {"in_teleop": False, "time": 147, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 148, "action_type": "auto_fail_score_F5_L4"},
                {"in_teleop": False, "time": 149, "action_type": "auto_intake_station_2"},
                {"in_teleop": False, "time": 150, "action_type": "auto_score_F1_L4"},
            ][::-1],
            "match_numbers_played": [],
            "path_number": 1,
            "num_matches_ran": 2,
            "is_sus": False,
        },
    ]

    expected_group_auto_paths = [
        {
            # 254, 1
            "path_number": 1,
            "match_numbers_played": [42],
            "num_matches_ran": 1,
            "team_number": "254",
            "timeline": str(
                [
                    "reef_F1_L4",
                    "station_1",
                    "reef_F3_L4",
                    "station_1",
                    "reef_F3_L4",
                    "intake_reef_4",
                ]
            ),
            "start_position": "1",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_1",
            "intake_position_2": "station_1",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "reef_F3_L4",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 1,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
        {
            # 1678, 1
            "path_number": 1,
            "match_numbers_played": [43],
            "num_matches_ran": 1,
            "team_number": "1678",
            "timeline": str(
                ["reef_F1_L4", "station_2", "reef_F5_L4", "station_2", "reef_F6_L4", "station_2"]
            ),
            "start_position": "2",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_2",
            "intake_position_2": "station_2",
            "intake_position_3": "station_2",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "reef_F5_L4",
            "score_3": "reef_F6_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 1,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
        {
            # 4414, 1
            "path_number": 1,
            "match_numbers_played": [44],
            "num_matches_ran": 1,
            "team_number": "4414",
            "timeline": str(
                ["net", "mark_1_coral", "net", "mark_2_algae", "processor", "mark_3_coral"]
            ),
            "start_position": "3",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "mark_1_coral",
            "intake_position_2": "mark_2_algae",
            "intake_position_3": "mark_3_coral",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "net",
            "score_2": "net",
            "score_3": "processor",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 1,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
        {
            # 254, 2
            "path_number": 2,
            "match_numbers_played": [45],
            "num_matches_ran": 1,
            "team_number": "254",
            "timeline": str(
                [
                    "reef_F1_L4",
                    "station_1",
                    "fail_reef_F5_L2",
                    "station_1",
                    "reef_F3_L4",
                    "intake_reef_4",
                ]
            ),
            "start_position": "1",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_1",
            "intake_position_2": "station_1",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "fail_reef_F5_L2",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 0,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
        {
            # 1678, 2
            "path_number": 1,
            "match_numbers_played": [46, 43],
            "num_matches_ran": 2,
            "team_number": "1678",
            "timeline": str(
                ["reef_F1_L4", "station_2", "reef_F5_L4", "station_2", "reef_F6_L4", "station_2"]
            ),
            "start_position": "2",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_2",
            "intake_position_2": "station_2",
            "intake_position_3": "station_2",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "reef_F5_L4",
            "score_3": "reef_F6_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 2,
            "score_2_successes": 1,
            "score_3_successes": 2,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
    ]

    expected_auto_paths = [
        {
            # 254, 1
            "path_number": 1,
            "match_numbers_played": [42],
            "num_matches_ran": 1,
            "team_number": "254",
            "timeline": str(
                [
                    "reef_F1_L4",
                    "station_1",
                    "reef_F3_L4",
                    "station_1",
                    "reef_F3_L4",
                    "intake_reef_4",
                ]
            ),
            "start_position": "1",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_1",
            "intake_position_2": "station_1",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "reef_F3_L4",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 1,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
        {
            # 4414, 1
            "path_number": 1,
            "match_numbers_played": [44],
            "num_matches_ran": 1,
            "team_number": "4414",
            "timeline": str(
                ["net", "mark_1_coral", "net", "mark_2_algae", "processor", "mark_3_coral"]
            ),
            "start_position": "3",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "mark_1_coral",
            "intake_position_2": "mark_2_algae",
            "intake_position_3": "mark_3_coral",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "net",
            "score_2": "net",
            "score_3": "processor",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 1,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
        {
            # 254, 2
            "path_number": 2,
            "match_numbers_played": [45],
            "num_matches_ran": 1,
            "team_number": "254",
            "timeline": str(
                [
                    "reef_F1_L4",
                    "station_1",
                    "fail_reef_F5_L2",
                    "station_1",
                    "reef_F3_L4",
                    "intake_reef_4",
                ]
            ),
            "start_position": "1",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_1",
            "intake_position_2": "station_1",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "fail_reef_F5_L2",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 0,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
        {
            # 1678, 1
            "path_number": 1,
            "match_numbers_played": [46, 43],
            "num_matches_ran": 2,
            "team_number": "1678",
            "timeline": str(
                ["reef_F1_L4", "station_2", "reef_F5_L4", "station_2", "reef_F6_L4", "station_2"]
            ),
            "start_position": "2",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_2",
            "intake_position_2": "station_2",
            "intake_position_3": "station_2",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "reef_F5_L4",
            "score_3": "reef_F6_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 2,
            "score_2_successes": 1,
            "score_3_successes": 2,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        },
    ]

    expected_auto_path = [
        {
            "path_number": 1,
            "match_numbers_played": [42],
            "num_matches_ran": 1,
            "team_number": "254",
            "timeline": str(
                [
                    "reef_F1_L4",
                    "station_1",
                    "reef_F3_L4",
                    "station_1",
                    "reef_F3_L4",
                    "intake_reef_4",
                ]
            ),
            "start_position": "1",
            "has_preload": True,
            "leave": True,
            "intake_position_1": "station_1",
            "intake_position_2": "station_1",
            "intake_position_3": "intake_reef_4",
            "intake_position_4": "none",
            "intake_position_5": "none",
            "intake_position_6": "none",
            "intake_position_7": "none",
            "intake_position_8": "none",
            "intake_position_9": "none",
            "intake_position_10": "none",
            "intake_position_11": "none",
            "intake_position_12": "none",
            "score_1": "reef_F1_L4",
            "score_2": "reef_F3_L4",
            "score_3": "reef_F3_L4",
            "score_4": "none",
            "score_5": "none",
            "score_6": "none",
            "score_7": "none",
            "score_8": "none",
            "score_9": "none",
            "score_10": "none",
            "score_11": "none",
            "score_12": "none",
            "score_13": "none",
            "score_1_successes": 1,
            "score_2_successes": 1,
            "score_3_successes": 1,
            "score_4_successes": 0,
            "score_5_successes": 0,
            "score_6_successes": 0,
            "score_7_successes": 0,
            "score_8_successes": 0,
            "score_9_successes": 0,
            "score_10_successes": 0,
            "score_11_successes": 0,
            "score_12_successes": 0,
            "score_13_successes": 0,
            "is_sus": False,
        }
    ]

    @mock.patch.object(
        base_calculations.BaseCalculations, "get_teams_list", return_value=["1678", "4414", "254"]
    )
    def setup_method(self, method, get_teams_list_dummy):
        with mock.patch(
            "doozernet_communicator.check_model_availability", return_value=None
        ), mock.patch("utils.get_match_schedule", return_value=[]), mock.patch(
            "utils.get_team_list", return_value=[]
        ):
            self.test_server = Server()
        self.test_calculator = auto_paths.AutoPathCalc(self.test_server)
        # Insert test data into database for testing
        self.test_server.local_db.insert_documents("auto_pim", self.auto_pims)
        self.test_server.local_db.insert_documents("obj_team", self.obj_teams)

    def test___init__(self):
        assert self.test_calculator.server == self.test_server
        assert self.test_calculator.watched_collections == [
            "auto_pim",
        ]

    def test_group_auto_paths(self):
        # self.test_server.local_db.delete_data("auto_paths")
        # 254, 1
        assert (
            self.test_calculator.group_auto_paths(self.auto_pims[0], [])
            == self.expected_group_auto_paths[0]
        )
        self.test_server.local_db.insert_documents("auto_paths", self.expected_group_auto_paths[0])

        # 1678, 1
        assert (
            self.test_calculator.group_auto_paths(self.auto_pims[1], [])
            == self.expected_group_auto_paths[1]
        )
        self.test_server.local_db.insert_documents("auto_paths", self.expected_group_auto_paths[1])

        # 4414, 1
        assert (
            self.test_calculator.group_auto_paths(self.auto_pims[2], [])
            == self.expected_group_auto_paths[2]
        )
        self.test_server.local_db.insert_documents("auto_paths", self.expected_group_auto_paths[2])

        # 254, 2
        assert (
            self.test_calculator.group_auto_paths(self.auto_pims[3], [])
            == self.expected_group_auto_paths[3]
        )
        self.test_server.local_db.delete_data("auto_paths", {"team_number": "254"})
        self.test_server.local_db.insert_documents("auto_paths", self.expected_group_auto_paths[3])

        # 1678, 2
        assert (
            self.test_calculator.group_auto_paths(self.auto_pims[4], [])
            == self.expected_group_auto_paths[4]
        )
        self.test_server.local_db.delete_data("auto_paths", {"team_number": "1678"})
        self.test_server.local_db.insert_documents("auto_paths", self.expected_group_auto_paths[4])

    def test_calculate_auto_paths(self):
        calculated_auto_paths = self.test_calculator.calculate_auto_paths(
            [{"match_number": 42, "team_number": "254"}]
        )
        assert len(calculated_auto_paths) == 1
        assert len(self.expected_auto_path) == 1
        assert calculated_auto_paths[0] == self.expected_auto_path[0]

    def test_run(self):
        # Delete any data that is already in the database collections
        self.test_server.local_db.delete_data("auto_paths")
        self.test_server.local_db.delete_data("auto_pim")
        self.test_server.local_db.delete_data("obj_team")
        # Insert test data for the run function
        self.test_server.local_db.insert_documents("auto_pim", self.auto_pims)
        self.test_server.local_db.insert_documents("obj_team", self.obj_teams)
        self.test_calculator.run()
        result = self.test_server.local_db.find("auto_paths")

        for document in result:
            del document["_id"]

        assert result == self.expected_auto_paths

        obj_teams_result = self.test_server.local_db.find("obj_team")

        for obj_team_document in obj_teams_result:
            del obj_team_document["_id"]

        assert obj_teams_result == self.expected_obj_teams

        pim_result = self.test_server.local_db.find("auto_pim")

        for pim_document in pim_result:
            del pim_document["_id"]

        assert pim_result == self.expected_auto_pims
